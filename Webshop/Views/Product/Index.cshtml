@inject Webshop.Services.ProductHandler _ProductHandler;
@using System.Collections
@using System.Diagnostics.Metrics
@using System.Runtime.CompilerServices
@using Webshop.Models
@model IList<Webshop.Models.Product>;

<style>
    body {
        background: #FBF8F1;
    }


    a,
    a:hover {
        text-decoration: none;
        color: inherit;
    }


    /* .section-products {
        
        margin-left: 5rem;
        margin-right: 5rem;
        padding: 80px 0 54px;
        background: #FBF8F1;
        /* background: rgb(186,109,84);
        background: linear-gradient(180deg, rgba(186,109,84,0.5552491260175945) 0%, rgba(0,212,255,0.14628554058342091) 100%);
        margin-bottom: 5rem;
        box-shadow: 1px 1px 5px black;
       
    }*/

        .section-products .header {
            margin-bottom: 50px;
        }

            .section-products .header h3 {
                font-size: 1rem;
                color: #fe302f;
                font-weight: 500;
            }

            .section-products .header h2 {
                font-size: 2.2rem;
                font-weight: 400;
                color: #444444;
            }
            .container {
                max-width: 80%;
            }
        .section-products .single-product {
            margin-bottom: 26px;
            
        }
    .section-products .single-product:hover {
        box-shadow: 0px 0px 10px teal;
    }

            .section-products .single-product  {
                position: relative;
                display: flex;
                justify-content: center;
                align-items: center;
                box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
                max-height: 430px;
                max-width: 350px;
                
                overflow: hidden;
            }

                .section-products .single-product .part-1::before {
                    position: absolute;
                    content: "";
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    z-index: -1;
                    transition: all 0.3s;
                  

                }

            .section-products .single-product:hover::before {
                transform: scale(1.2,1.2) rotate(5deg);
            }




            .section-products .single-product .part-1 .discount,
            .section-products .single-product .part-1 .new {
                position: absolute;
                top: 15px;
                left: 20px;
                color: #ffffff;
                background-color: #fe302f;
                padding: 2px 8px;
                text-transform: uppercase;
                font-size: 0.85rem;
            }

            .section-products .single-product .part-1 .new {
                left: 0;
                background-color: #444444;
            }

       
            .section-products .single-product .part-2 .product-title {
                font-size: 0.9rem;
            }

            .section-products .single-product .part-2 .card-subtitle {
                font-size: 0.5rem;
            }

    
           

    

    .header-img {
        background: url("/img/makeup.jpg");
        background-size: cover;
        background-repeat: no-repeat;
    }

    .img-product {
       
        max-width: 240px;
        min-height: 280px;
        max-height: 300px;
        object-fit: cover;
    }

    .bi-cart-fill {
        width: 10px;
        height: 10px;
    }
    .bi-star-fill {
        color: goldenrod;
      
    }

    .inner {
      
        position: absolute;
        
    }
    .btn {
        font-size: 1vw;
    }
    .hide{ 
        display: none;
    }
    .show:hover + .hide {
        display:block;
        color: red;
    }
  .btn-group {
      justify-items: self-start;
  }
    .card-body {
        padding: 0.5rem 0.5rem;

    }
    .card {
        height: 450px;
        background: none;
        border: none;
    }
    
    .cart + .card:hover {
        display: flex;
        
    }
    .txt-shadow-custom {
        text-shadow: 1px 2px 3px whitesmoke;
    }
   
</style>

@functions{
    
    void RatingStars(double? rating)
    {
        @if (rating > 5)
        {
            rating = 5;
        }
           
        <div class="">
          
            @for (int i = 0; i < rating; i++)
            {
                <i class=" bi bi-star-fill"></i>
            }
        </div>
        
    }


    async Task RenderMostPopular()
    {


        foreach (var product in @Model)
        {

            <!-- Single Product -->
            <div class="col-md-6 col-lg-4 col-xl-3">
               
                <div id="product-1 " class="single-product card">




                    <div class="card">
                        <a class="  stretched-link" asp-controller="Product" asp-action="Product" asp-route-id=@product.Id></a>
                        <img class="card-img-top img-product"src=@product.Image
                             alt="100%x280" onerror="this.onerror = null;this.src = '/img/Razor Cosmetics placeholder.png';"/>
                    </div>
                    



                    <div class="part-2 card-body  text-center">


                        <h3 class="product-title">@product.Name</h3>

                        @if (product.Brand == "NULL")
                        {
                            <h6 class="product-subtitle mb-2 text-muted"> By: <strong>Static Void Cosmetics</strong></h6>
                        }
                        else
                        {
                            <h6 class="product-subtitle mb-2 text-muted"> By: <strong>@product.Brand</strong></h6>
                        }


                        <h4 class="product-price">@product.Price &euro;</h4>
                        @if (product.Rating != null)
                        {
                            var ratingCount = @product.Rating;

                            RatingStars(ratingCount);

                        }
                        <div class="justify-content-start mb-3">
                            <a href="#"><i class="bi bi-cart cart   btn-outline-dark "></i></a>
                        </div>

                    </div>

                </div>
            </div>

        }
    }
    async Task RenderRecommended()
    {
        var recommendedList = _ProductHandler.GetRecommendedProducts("lipstick", 12).Result.AsEnumerable();


        foreach (var product in @recommendedList)
        {

            <!-- Single Product -->
            <div class="col-md-6 col-lg-4 col-xl-3">
                <div id="product-1 " class="single-product card">
                  
                    
                   
                    <div class="card">
                        <a class="stretched-link" asp-controller="Product" asp-action="Product" asp-route-id=@product.Id></a>
                        <img class="card-img-top border-0 img-product"src=@product.Image
                             alt="100%x280" onerror="this.onerror = null;this.src = '/img/Razor Cosmetics placeholder.png';"/>
                    </div>
                    
                   
                    <div class="part-2 card-body center text-center">
                        
                       
                        <h3 class="product-title">@product.Name</h3>

                        @if (product.Brand == "NULL")
                        {
                            <h6 class="product-subtitle mb-2 text-muted"> By: <strong>Static Void Cosmetics</strong></h6>
                        }
                        else
                        {
                            <h6 class="product-subtitle mb-2 text-muted"> By: <strong>@product.Brand</strong></h6>
                        }


                        <h4 class="product-price">@product.Price &euro;</h4>
                        @if (product.Rating != null)
                        {
                            var ratingCount = @product.Rating;

                            RatingStars(ratingCount);

                        }
                        <div class="justify-content-start  mb-3">
                            <a href="#"><i class="bi bi-cart   btn-outline-dark "></i></a>
                        </div>

                    </div>

                </div>
            </div>

        }
    }



   async Task RenderByBrand()
    {

        var fromBrandList =  _ProductHandler.GetProductsByBrand("maybelline", 11).Result.AsEnumerable();



        foreach (var product in @fromBrandList)
        {

            <!-- Single Product -->
            <div class="col-md-6 col-lg-4 col-xl-3">
                <div id="product-1 " class="single-product card">
                  
                    
                   
                    <div class="card">
                        <a class="  stretched-link" asp-controller="Product" asp-action="Product" asp-route-id=@product.Id></a>
                        <img class="card-img-top img-product"src=@product.Image
                             alt="100%x280" onerror="this.onerror = null;this.src = '/img/Razor Cosmetics placeholder.png';"/>
                    </div>
                    
                    
                    <div class="part-2 card-body center text-center">
                        
                       
                        <h3 class="product-title">@product.Name</h3>

                        @if (product.Brand == "NULL")
                        {
                            <h6 class="product-subtitle mb-2 text-muted"> By: <strong>Static Void Cosmetics</strong></h6>
                        }
                        else
                        {
                            <h6 class="product-subtitle mb-2 text-muted"> By: <strong>@product.Brand</strong></h6>
                        }


                        <h4 class="product-price">@product.Price &euro;</h4>
                        @if (product.Rating != null)
                        {
                            var ratingCount = @product.Rating;

                            RatingStars(ratingCount);

                        }
                        <div class="justify-content-start   mb-3">
                            <a href="#"><i class="bi bi-cart   btn-outline-dark "></i></a>
                        </div>

                    </div>

                </div>
            </div>

        }
       

    }
}








<section class="section-products">
    <div class="container">
    <div class="g-3">


        <div class="row justify-content-center text-center border-4">
            <div class="col-md-8 col-lg-6">
                <div class="header my-4 border-bottom ">
                    <h2 class="txt-shadow-custom fw-bolder">Popular Products</h2>
                </div>
            </div>
        </div>

        <div class="row">

            @{
                await RenderMostPopular();
            }

        </div>

        
        <div class="row justify-content-center text-center border-4">
            <div class="col-md-8 col-lg-6">
                <div class="header my-4 border-bottom ">
                    <h2 class="txt-shadow-custom fw-bolder">Recommended for you</h2>
                </div>
            </div>
        </div>

        <div class="row">
            @{
                await RenderRecommended();
            }


        </div>


        <div class="row justify-content-center text-center border-4">
            <div class="col-md-8 col-lg-6">
                <div class="header my-4 border-bottom ">
                    <h2 class="txt-shadow-custom fw-bolder">by Maybelline</h2>
                </div>
            </div>
        </div>
        <div class="row">
            @{
                await RenderByBrand();
            }


        </div>


    </div>
    </div>
</section>